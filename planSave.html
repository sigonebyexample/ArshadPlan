<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Study Planner with Auto-Save</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --success: #27ae60;
            --warning: #f39c12;
            --danger: #e74c3c;
            --light: #ecf0f1;
            --dark: #34495e;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        h1 {
            font-size: 2.2rem;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .main-controls {
            display: flex;
            gap: 15px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background-color: var(--secondary);
            color: white;
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        .btn-warning {
            background-color: var(--warning);
            color: white;
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 25px;
        }
        
        .dashboard-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            text-align: center;
        }
        
        .dashboard-card h3 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        
        .dashboard-card p {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--secondary);
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 500;
            flex: 1;
            text-align: center;
        }
        
        .tab.active {
            background-color: var(--secondary);
            color: white;
        }
        
        .tab:hover:not(.active) {
            background-color: var(--light);
        }
        
        .tab-content {
            display: none;
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .calendar-header {
            grid-column: 1 / -1;
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 10px;
            text-align: center;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .calendar-day {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            min-height: 120px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .calendar-day:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .calendar-day.current {
            border: 2px solid var(--secondary);
        }
        
        .calendar-day.completed {
            background-color: rgba(39, 174, 96, 0.1);
        }
        
        .day-number {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--primary);
        }
        
        .day-tasks {
            font-size: 0.8rem;
            color: var(--dark);
        }
        
        .task-item {
            background: var(--light);
            padding: 5px;
            margin: 3px 0;
            border-radius: 3px;
            display: flex;
            align-items: center;
        }
        
        .task-checkbox {
            margin-right: 5px;
        }
        
        .task-completed {
            text-decoration: line-through;
            opacity: 0.7;
        }
        
        .daily-schedule {
            margin-bottom: 20px;
        }
        
        .time-slot {
            display: flex;
            margin-bottom: 10px;
            align-items: center;
            padding: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .time {
            width: 120px;
            font-weight: 500;
            color: var(--dark);
        }
        
        .subject {
            flex: 1;
            padding: 10px 15px;
            background-color: var(--light);
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .subject-name {
            font-weight: 500;
        }
        
        .subject-duration {
            color: var(--dark);
            font-size: 0.9rem;
        }
        
        .completion-checkbox {
            margin-left: 15px;
            transform: scale(1.3);
        }
        
        .timer-section {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
            text-align: center;
        }
        
        .timer-display {
            font-size: 3rem;
            font-weight: bold;
            color: var(--primary);
            margin: 20px 0;
        }
        
        .timer-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        
        .alarm-section {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        
        .alarm-controls {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }
        
        .alarm-input {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            flex: 1;
        }
        
        .progress-section {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
        }
        
        .progress-title {
            font-size: 1.3rem;
            color: var(--primary);
            margin-bottom: 20px;
        }
        
        .progress-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .progress-item {
            margin-bottom: 15px;
        }
        
        .progress-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        
        .progress-bar {
            height: 10px;
            background-color: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background-color: var(--success);
            border-radius: 5px;
            transition: width 0.5s ease;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--dark);
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        
        .auto-save-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 1001;
        }
        
        .auto-save-indicator.show {
            opacity: 1;
        }
        
        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .calendar {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .calendar-header {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .timer-controls, .alarm-controls {
                flex-direction: column;
            }
            
            header {
                flex-direction: column;
                gap: 15px;
            }
            
            .main-controls {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div>
                <h1>Smart Study Planner</h1>
                <p class="subtitle">Auto-saves every 5 minutes â€¢ Track progress, set alarms, and customize your schedule</p>
            </div>
            <div class="main-controls">
                <button class="btn btn-primary" id="saveData">Save Now</button>
                <button class="btn btn-success" id="resetData">Reset Data</button>
                <button class="btn btn-warning" id="addTask">Add Task</button>
            </div>
        </header>
        
        <div class="dashboard">
            <div class="dashboard-card">
                <h3>Study Days Completed</h3>
                <p id="daysCompleted">0/200</p>
            </div>
            <div class="dashboard-card">
                <h3>Weekly Progress</h3>
                <p id="weeklyProgress">0%</p>
            </div>
            <div class="dashboard-card">
                <h3>Current Streak</h3>
                <p id="currentStreak">0 days</p>
            </div>
            <div class="dashboard-card">
                <h3>Next Exam</h3>
                <p id="examCountdown">200 days</p>
            </div>
        </div>
        
        <div class="tabs">
            <div class="tab active" data-tab="monthly">Monthly View</div>
            <div class="tab" data-tab="daily">Daily Schedule</div>
            <div class="tab" data-tab="progress">Progress Tracking</div>
            <div class="tab" data-tab="tools">Study Tools</div>
        </div>
        
        <div class="tab-content active" id="monthly">
            <h2>Study Calendar - <span id="currentMonth">Aban</span></h2>
            <div class="calendar-controls" style="margin-bottom: 15px;">
                <button class="btn btn-primary" id="prevMonth">Previous</button>
                <button class="btn btn-primary" id="nextMonth">Next</button>
            </div>
            <div class="calendar">
                <div class="calendar-header">
                    <div>Sat</div>
                    <div>Sun</div>
                    <div>Mon</div>
                    <div>Tue</div>
                    <div>Wed</div>
                    <div>Thu</div>
                    <div>Fri</div>
                </div>
                <div id="calendarDays">
                    <!-- Calendar days will be generated by JavaScript -->
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="daily">
            <h2>Daily Study Schedule - <span id="currentDate">15 Aban</span></h2>
            <div class="daily-controls" style="margin-bottom: 15px;">
                <button class="btn btn-primary" id="prevDay">Previous Day</button>
                <button class="btn btn-primary" id="nextDay">Next Day</button>
            </div>
            <div class="daily-schedule" id="dailySchedule">
                <!-- Daily schedule will be generated by JavaScript -->
            </div>
        </div>
        
        <div class="tab-content" id="progress">
            <div class="progress-section">
                <h2 class="progress-title">Study Progress Overview</h2>
                <div class="progress-grid" id="subjectProgress">
                    <!-- Progress bars will be generated by JavaScript -->
                </div>
            </div>
            
            <div class="progress-section">
                <h2 class="progress-title">Weekly Goals</h2>
                <div id="weeklyGoals">
                    <!-- Weekly goals will be generated by JavaScript -->
                </div>
            </div>
        </div>
        
        <div class="tab-content" id="tools">
            <div class="timer-section">
                <h2>Study Timer</h2>
                <div class="timer-display" id="timerDisplay">25:00</div>
                <div class="timer-controls">
                    <button class="btn btn-success" id="startTimer">Start</button>
                    <button class="btn btn-warning" id="pauseTimer">Pause</button>
                    <button class="btn btn-danger" id="resetTimer">Reset</button>
                </div>
                <div style="margin-top: 15px;">
                    <label for="timerDuration">Set Timer (minutes):</label>
                    <input type="number" id="timerDuration" min="1" max="120" value="25" style="margin-left: 10px; padding: 5px; width: 60px;">
                </div>
            </div>
            
            <div class="alarm-section">
                <h2>Study Alarms</h2>
                <p>Set reminders for your study sessions</p>
                <div class="alarm-controls">
                    <input type="time" class="alarm-input" id="alarmTime">
                    <input type="text" class="alarm-input" id="alarmMessage" placeholder="Alarm message">
                    <button class="btn btn-primary" id="setAlarm">Set Alarm</button>
                </div>
                <div id="alarmList" style="margin-top: 20px;">
                    <!-- Alarm list will be generated by JavaScript -->
                </div>
            </div>
        </div>
        
        <div class="auto-save-indicator" id="autoSaveIndicator">
            Auto-saved successfully!
        </div>
    </div>

    <!-- Add Task Modal -->
    <div class="modal" id="taskModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Study Task</h2>
                <button class="close-modal">&times;</button>
            </div>
            <form id="taskForm">
                <div class="form-group">
                    <label for="taskSubject">Subject</label>
                    <select class="form-control" id="taskSubject">
                        <option value="Electronics 1">Electronics 1</option>
                        <option value="Electronics 2">Electronics 2</option>
                        <option value="Electrical Circuits">Electrical Circuits</option>
                        <option value="Control Systems">Control Systems</option>
                        <option value="Engineering Mathematics">Engineering Mathematics</option>
                        <option value="Differential Equations">Differential Equations</option>
                        <option value="Electrical Machines">Electrical Machines</option>
                        <option value="Digital Logic">Digital Logic</option>
                        <option value="Technical English">Technical English</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="taskDate">Date</label>
                    <input type="date" class="form-control" id="taskDate">
                </div>
                <div class="form-group">
                    <label for="taskTime">Time</label>
                    <input type="time" class="form-control" id="taskTime">
                </div>
                <div class="form-group">
                    <label for="taskDuration">Duration (minutes)</label>
                    <input type="number" class="form-control" id="taskDuration" min="15" max="240" value="60">
                </div>
                <div class="form-group">
                    <label for="taskDescription">Description</label>
                    <input type="text" class="form-control" id="taskDescription" placeholder="What to study?">
                </div>
                <button type="submit" class="btn btn-success" style="width: 100%;">Add Task</button>
            </form>
        </div>
    </div>

    <script>
        // Data storage and management
        let studyData = {
            tasks: [],
            completed: [],
            progress: {},
            settings: {
                examDate: '2024-05-06', // 17 Ordibehesht
                dailyGoal: 6,
                weeklyGoal: 42
            },
            alarms: [],
            lastSave: null
        };

        // Auto-save variables
        let autoSaveInterval;
        const AUTO_SAVE_INTERVAL = 5 * 60 * 1000; // 5 minutes in milliseconds

        // Load data from localStorage
        function loadData() {
            const saved = localStorage.getItem('studyPlannerData');
            if (saved) {
                studyData = JSON.parse(saved);
                console.log('Data loaded from localStorage');
            } else {
                // Initialize with default tasks
                initializeDefaultTasks();
            }
            updateUI();
            startAutoSave();
        }

        // Save data to localStorage
        function saveData() {
            studyData.lastSave = new Date().toISOString();
            localStorage.setItem('studyPlannerData', JSON.stringify(studyData));
            showAutoSaveIndicator();
            console.log('Data saved to localStorage');
        }

        // Auto-save functionality
        function startAutoSave() {
            // Clear any existing interval
            if (autoSaveInterval) {
                clearInterval(autoSaveInterval);
            }
            
            // Set up new interval for auto-saving
            autoSaveInterval = setInterval(() => {
                saveData();
            }, AUTO_SAVE_INTERVAL);
            
            console.log('Auto-save started (every 5 minutes)');
        }

        // Show auto-save indicator
        function showAutoSaveIndicator() {
            const indicator = document.getElementById('autoSaveIndicator');
            indicator.textContent = `Auto-saved at ${new Date().toLocaleTimeString()}`;
            indicator.classList.add('show');
            
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 3000);
        }

        // Reset data
        function resetData() {
            if (confirm('Are you sure you want to reset all data? This cannot be undone.')) {
                localStorage.removeItem('studyPlannerData');
                studyData = {
                    tasks: [],
                    completed: [],
                    progress: {},
                    settings: {
                        examDate: '2024-05-06',
                        dailyGoal: 6,
                        weeklyGoal: 42
                    },
                    alarms: [],
                    lastSave: null
                };
                initializeDefaultTasks();
                updateUI();
            }
        }

        // Initialize with default tasks for the first 7 days
        function initializeDefaultTasks() {
            const subjects = [
                { name: 'Electronics 1', color: '#3498db' },
                { name: 'Electronics 2', color: '#2980b9' },
                { name: 'Electrical Circuits', color: '#e74c3c' },
                { name: 'Control Systems', color: '#9b59b6' },
                { name: 'Engineering Mathematics', color: '#f39c12' },
                { name: 'Differential Equations', color: '#d35400' },
                { name: 'Electrical Machines', color: '#1abc9c' },
                { name: 'Digital Logic', color: '#34495e' },
                { name: 'Technical English', color: '#7f8c8d' }
            ];

            // Add some sample tasks for the next 7 days
            const today = new Date();
            for (let i = 0; i < 7; i++) {
                const date = new Date(today);
                date.setDate(today.getDate() + i);
                const dateStr = date.toISOString().split('T')[0];
                
                // Add 3-5 tasks per day
                const taskCount = 3 + Math.floor(Math.random() * 3);
                for (let j = 0; j < taskCount; j++) {
                    const subject = subjects[Math.floor(Math.random() * subjects.length)];
                    const hour = 7 + Math.floor(Math.random() * 12);
                    const minute = Math.floor(Math.random() * 4) * 15; // 0, 15, 30, or 45
                    
                    studyData.tasks.push({
                        id: Date.now() + Math.random(),
                        subject: subject.name,
                        date: dateStr,
                        time: `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`,
                        duration: 60 + Math.floor(Math.random() * 60),
                        description: `Study ${subject.name} - Chapter ${Math.floor(Math.random() * 5) + 1}`,
                        color: subject.color
                    });
                }
            }
            
            // Save initial data
            saveData();
        }

        // Update all UI elements
        function updateUI() {
            updateDashboard();
            updateCalendar();
            updateDailySchedule();
            updateProgress();
            updateAlarms();
        }

        // Update dashboard statistics
        function updateDashboard() {
            // Calculate days completed
            const uniqueDays = new Set(studyData.completed.map(c => c.date));
            document.getElementById('daysCompleted').textContent = `${uniqueDays.size}/200`;
            
            // Calculate weekly progress (simplified)
            const weeklyProgress = Math.min(100, Math.floor((uniqueDays.size / 200) * 100));
            document.getElementById('weeklyProgress').textContent = `${weeklyProgress}%`;
            
            // Calculate current streak (simplified)
            document.getElementById('currentStreak').textContent = `${uniqueDays.size} days`;
            
            // Calculate days until exam
            const examDate = new Date(studyData.settings.examDate);
            const today = new Date();
            const diffTime = examDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            document.getElementById('examCountdown').textContent = `${diffDays} days`;
        }

        // Update calendar view
        function updateCalendar() {
            const calendarDays = document.getElementById('calendarDays');
            calendarDays.innerHTML = '';
            
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            
            // Set month name
            const monthNames = ["Farvardin", "Ordibehesht", "Khordad", "Tir", "Mordad", "Shahrivar", 
                               "Mehr", "Aban", "Azar", "Dey", "Bahman", "Esfand"];
            document.getElementById('currentMonth').textContent = monthNames[currentMonth];
            
            // Get first day of month and number of days
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            
            // Add empty cells for days before the first day of the month
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day';
                calendarDays.appendChild(emptyDay);
            }
            
            // Add days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                
                // Check if this is today
                if (day === today.getDate() && currentMonth === today.getMonth()) {
                    dayElement.classList.add('current');
                }
                
                // Check if this day has completed tasks
                const dateStr = `${currentYear}-${(currentMonth + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
                const dayTasks = studyData.tasks.filter(task => task.date === dateStr);
                const completedTasks = studyData.completed.filter(c => c.date === dateStr);
                
                if (completedTasks.length > 0 && completedTasks.length === dayTasks.length) {
                    dayElement.classList.add('completed');
                }
                
                dayElement.innerHTML = `
                    <div class="day-number">${day}</div>
                    <div class="day-tasks">${dayTasks.length} tasks</div>
                    ${dayTasks.slice(0, 3).map(task => `
                        <div class="task-item">
                            <input type="checkbox" class="task-checkbox" ${studyData.completed.some(c => c.taskId === task.id) ? 'checked' : ''} 
                                onchange="toggleTaskCompletion(${task.id}, this.checked)">
                            <span class="${studyData.completed.some(c => c.taskId === task.id) ? 'task-completed' : ''}">${task.subject}</span>
                        </div>
                    `).join('')}
                    ${dayTasks.length > 3 ? `<div class="day-tasks">+${dayTasks.length - 3} more</div>` : ''}
                `;
                
                calendarDays.appendChild(dayElement);
            }
        }

        // Update daily schedule
        function updateDailySchedule() {
            const dailySchedule = document.getElementById('dailySchedule');
            dailySchedule.innerHTML = '';
            
            const today = new Date();
            const dateStr = today.toISOString().split('T')[0];
            document.getElementById('currentDate').textContent = formatDate(today);
            
            const dayTasks = studyData.tasks
                .filter(task => task.date === dateStr)
                .sort((a, b) => a.time.localeCompare(b.time));
            
            if (dayTasks.length === 0) {
                dailySchedule.innerHTML = '<p>No tasks scheduled for today. Add some tasks to get started!</p>';
                return;
            }
            
            dayTasks.forEach(task => {
                const timeSlot = document.createElement('div');
                timeSlot.className = 'time-slot';
                
                const isCompleted = studyData.completed.some(c => c.taskId === task.id);
                
                timeSlot.innerHTML = `
                    <div class="time">${task.time}</div>
                    <div class="subject" style="border-left: 4px solid ${task.color}">
                        <span class="subject-name">${task.subject}</span>
                        <span class="subject-duration">${task.duration} min</span>
                    </div>
                    <input type="checkbox" class="completion-checkbox" ${isCompleted ? 'checked' : ''} 
                        onchange="toggleTaskCompletion(${task.id}, this.checked)">
                `;
                
                if (isCompleted) {
                    timeSlot.style.opacity = '0.7';
                }
                
                dailySchedule.appendChild(timeSlot);
            });
        }

        // Update progress tracking
        function updateProgress() {
            const subjectProgress = document.getElementById('subjectProgress');
            subjectProgress.innerHTML = '';
            
            const subjects = [
                'Electronics 1', 'Electronics 2', 'Electrical Circuits', 'Control Systems',
                'Engineering Mathematics', 'Differential Equations', 'Electrical Machines',
                'Digital Logic', 'Technical English'
            ];
            
            subjects.forEach(subject => {
                const subjectTasks = studyData.tasks.filter(task => task.subject === subject);
                const completedTasks = studyData.completed.filter(c => 
                    studyData.tasks.some(task => task.id === c.taskId && task.subject === subject)
                );
                
                const progress = subjectTasks.length > 0 ? 
                    Math.round((completedTasks.length / subjectTasks.length) * 100) : 0;
                
                const progressItem = document.createElement('div');
                progressItem.className = 'progress-item';
                progressItem.innerHTML = `
                    <div class="progress-header">
                        <span>${subject}</span>
                        <span>${progress}%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progress}%"></div>
                    </div>
                `;
                
                subjectProgress.appendChild(progressItem);
            });
        }

        // Update alarms list
        function updateAlarms() {
            const alarmList = document.getElementById('alarmList');
            alarmList.innerHTML = '';
            
            if (studyData.alarms.length === 0) {
                alarmList.innerHTML = '<p>No alarms set. Add an alarm to get reminders for your study sessions.</p>';
                return;
            }
            
            studyData.alarms.forEach(alarm => {
                const alarmElement = document.createElement('div');
                alarmElement.className = 'time-slot';
                alarmElement.innerHTML = `
                    <div class="time">${alarm.time}</div>
                    <div class="subject">
                        <span class="subject-name">${alarm.message}</span>
                    </div>
                    <button class="btn btn-danger" onclick="removeAlarm('${alarm.id}')">Remove</button>
                `;
                alarmList.appendChild(alarmElement);
            });
        }

        // Toggle task completion
        function toggleTaskCompletion(taskId, completed) {
            if (completed) {
                studyData.completed.push({
                    taskId: taskId,
                    date: new Date().toISOString().split('T')[0],
                    timestamp: new Date().toISOString()
                });
            } else {
                studyData.completed = studyData.completed.filter(c => c.taskId !== taskId);
            }
            updateUI();
            // Auto-save when task completion changes
            saveData();
        }

        // Set alarm
        function setAlarm() {
            const time = document.getElementById('alarmTime').value;
            const message = document.getElementById('alarmMessage').value;
            
            if (!time || !message) {
                alert('Please enter both time and message for the alarm.');
                return;
            }
            
            studyData.alarms.push({
                id: Date.now().toString(),
                time: time,
                message: message
            });
            
            document.getElementById('alarmTime').value = '';
            document.getElementById('alarmMessage').value = '';
            
            updateAlarms();
            saveData(); // Auto-save when alarm is added
            alert('Alarm set successfully!');
        }

        // Remove alarm
        function removeAlarm(alarmId) {
            studyData.alarms = studyData.alarms.filter(alarm => alarm.id !== alarmId);
            updateAlarms();
            saveData(); // Auto-save when alarm is removed
        }

        // Timer functionality
        let timerInterval;
        let timerSeconds = 25 * 60; // 25 minutes default
        
        function startTimer() {
            clearInterval(timerInterval);
            
            timerInterval = setInterval(() => {
                timerSeconds--;
                updateTimerDisplay();
                
                if (timerSeconds <= 0) {
                    clearInterval(timerInterval);
                    alert('Timer finished! Time for a break.');
                }
            }, 1000);
        }
        
        function pauseTimer() {
            clearInterval(timerInterval);
        }
        
        function resetTimer() {
            clearInterval(timerInterval);
            const duration = parseInt(document.getElementById('timerDuration').value) || 25;
            timerSeconds = duration * 60;
            updateTimerDisplay();
        }
        
        function updateTimerDisplay() {
            const minutes = Math.floor(timerSeconds / 60);
            const seconds = timerSeconds % 60;
            document.getElementById('timerDisplay').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        // Format date for display
        function formatDate(date) {
            const options = { day: 'numeric', month: 'long' };
            return date.toLocaleDateString('en-US', options);
        }

        // Tab functionality
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab).classList.add('active');
            });
        });

        // Modal functionality
        const taskModal = document.getElementById('taskModal');
        const closeModal = document.querySelector('.close-modal');
        const addTaskBtn = document.getElementById('addTask');
        
        addTaskBtn.addEventListener('click', () => {
            taskModal.style.display = 'flex';
            // Set default date to today
            document.getElementById('taskDate').value = new Date().toISOString().split('T')[0];
        });
        
        closeModal.addEventListener('click', () => {
            taskModal.style.display = 'none';
        });
        
        window.addEventListener('click', (e) => {
            if (e.target === taskModal) {
                taskModal.style.display = 'none';
            }
        });

        // Task form submission
        document.getElementById('taskForm').addEventListener('submit', (e) => {
            e.preventDefault();
            
            const subject = document.getElementById('taskSubject').value;
            const date = document.getElementById('taskDate').value;
            const time = document.getElementById('taskTime').value;
            const duration = document.getElementById('taskDuration').value;
            const description = document.getElementById('taskDescription').value;
            
            studyData.tasks.push({
                id: Date.now(),
                subject: subject,
                date: date,
                time: time,
                duration: parseInt(duration),
                description: description,
                color: '#3498db' // Default color
            });
            
            taskModal.style.display = 'none';
            document.getElementById('taskForm').reset();
            updateUI();
            saveData(); // Auto-save when task is added
        });

        // Button event listeners
        document.getElementById('saveData').addEventListener('click', saveData);
        document.getElementById('resetData').addEventListener('click', resetData);
        document.getElementById('setAlarm').addEventListener('click', setAlarm);
        document.getElementById('startTimer').addEventListener('click', startTimer);
        document.getElementById('pauseTimer').addEventListener('click', pauseTimer);
        document.getElementById('resetTimer').addEventListener('click', resetTimer);

        // Initialize the application
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            resetTimer(); // Initialize timer display
            
            // Show last save time if available
            if (studyData.lastSave) {
                const lastSaveDate = new Date(studyData.lastSave);
                console.log(`Last save: ${lastSaveDate.toLocaleString()}`);
            }
        });
    </script>
</body>
</html>
